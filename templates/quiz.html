<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Armenian Alphabet Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script>
        async function fetchQuestion() {
            const questionCategory = getSelectedCategory('questionCategory');
            const answerCategory = getSelectedCategory('answerCategory');
            const response = await fetch('/get_question', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `category=${questionCategory}&answer_category=${answerCategory}`
            });
            const data = await response.json();
            displayQuestion(data);
        }

        function getSelectedCategory(categoryName) {
            const selectedValue = document.querySelector(`input[name="${categoryName}"]:checked`).value;
            if (selectedValue === 'random') {
                const categories = ['uppercase', 'lowercase', 'transcription', 'pronunciation', 'handwritten'];
                return categories[Math.floor(Math.random() * categories.length)];
            }
            return selectedValue;
        }

        function displayQuestion(data) {
            const questionElement = document.getElementById('question');
            const choicesElement = document.getElementById('choices');
            const feedbackElement = document.getElementById('feedback');
            choicesElement.innerHTML = '';
            feedbackElement.textContent = ''; // Clear feedback

            if (data.question.endsWith('.ogg')) {
                questionElement.innerHTML = `<audio controls src="${data.question}"></audio>`;
            } else if (data.question.endsWith('.svg')) {
                questionElement.innerHTML = `<img src="${data.question}" class="handwritten-img" alt="Handwritten Letter">`;
            } else {
                questionElement.textContent = data.question;
            }

            data.choices.forEach(choice => {
                let element;
                if (choice.endsWith('.ogg')) {
                    element = document.createElement('audio');
                    element.controls = true;
                    element.src = choice;
                    element.className = "btn btn-primary btn-block";
                } else if (choice.endsWith('.svg')) {
                    element = document.createElement('button');
                    element.innerHTML = `<img src="${choice}" class="handwritten-img" alt="Handwritten Letter">`;
                    element.className = "btn btn-primary btn-block";
                } else {
                    element = document.createElement('button');
                    element.textContent = choice;
                    element.className = "btn btn-primary btn-block";
                }
                element.onclick = () => checkAnswer(choice, data.correct, data.all_categories);
                choicesElement.appendChild(element);
            });
        }

        function checkAnswer(choice, correct, allCategories) {
            const feedbackElement = document.getElementById('feedback');
            if (choice === correct) {
                feedbackElement.textContent = 'Correct!';
                feedbackElement.className = 'text-success';
                setTimeout(fetchQuestion, 1500); // Fetch new question after 1.5 seconds
            } else {
                displayCard(allCategories);
            }
        }

        function displayCard(allCategories) {
            const card = document.getElementById('infoCard');
            card.style.display = 'block';

            document.getElementById('cardUppercase').textContent = allCategories.uppercase;
            document.getElementById('cardLowercase').textContent = allCategories.lowercase;
            document.getElementById('cardTranscription').textContent = allCategories.transcription;
            document.getElementById('cardHandwritten').innerHTML = `<img src="${allCategories.handwritten}" class="handwritten-img">`;
            document.getElementById('cardPronunciation').innerHTML = `<audio controls src="${allCategories.pronunciation}"></audio>`;
        }

        function closeCard() {
            document.getElementById('infoCard').style.display = 'none';
            fetchQuestion();
        }
    </script>
</head>
<body onload="fetchQuestion()">
    <div class="container">
        <h1>Armenian Alphabet Quiz</h1>

        <!-- Question Category Selection -->
        <form class="mb-4">
            <h5>Select Question Category:</h5>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="questionCategory" id="uppercase" value="uppercase" checked>
                <label class="form-check-label" for="uppercase">Uppercase</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="questionCategory" id="lowercase" value="lowercase">
                <label class="form-check-label" for="lowercase">Lowercase</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="questionCategory" id="transcription" value="transcription">
                <label class="form-check-label" for="transcription">Transcription</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="questionCategory" id="pronunciation" value="pronunciation">
                <label class="form-check-label" for="pronunciation">Pronunciation</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="questionCategory" id="handwritten" value="handwritten">
                <label class="form-check-label" for="handwritten">Handwritten</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="questionCategory" id="randomQuestion" value="random">
                <label class="form-check-label" for="randomQuestion">Random</label>
            </div>
        </form>

        <!-- Answer Category Selection -->
        <form class="mb-4">
            <h5>Select Answer Category:</h5>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answerCategory" id="uppercaseAnswer" value="uppercase" checked>
                <label class="form-check-label" for="uppercaseAnswer">Uppercase</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answerCategory" id="lowercaseAnswer" value="lowercase">
                <label class="form-check-label" for="lowercaseAnswer">Lowercase</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answerCategory" id="transcriptionAnswer" value="transcription">
                <label class="form-check-label" for="transcriptionAnswer">Transcription</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answerCategory" id="pronunciationAnswer" value="pronunciation">
                <label class="form-check-label" for="pronunciationAnswer">Pronunciation</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answerCategory" id="handwrittenAnswer" value="handwritten">
                <label class="form-check-label" for="handwrittenAnswer">Handwritten</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answerCategory" id="randomAnswer" value="random">
                <label class="form-check-label" for="randomAnswer">Random</label>
            </div>
        </form>

        <!-- Display Question and Choices -->
        <div id="question" class="mb-4"></div>
        <div id="choices"></div>
        <div id="feedback" class="mt-4"></div>

        <!-- Info Card for Incorrect Answer -->
        <div id="infoCard" class="card" style="display: none; padding: 20px;">
            <h5>Correct Answer Details</h5>
            <p><strong>Uppercase:</strong> <span id="cardUppercase"></span></p>
            <p><strong>Lowercase:</strong> <span id="cardLowercase"></span></p>
            <p><strong>Transcription:</strong> <span id="cardTranscription"></span></p>
            <p><strong>Handwritten:</strong> <span id="cardHandwritten"></span></p>
            <p><strong>Pronunciation:</strong> <span id="cardPronunciation"></span></p>
            <button class="btn btn-primary" onclick="closeCard()">Next</button>
        </div>
    </div>
</body>
</html>
